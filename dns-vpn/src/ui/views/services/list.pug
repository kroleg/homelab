extends ../layout.pug

block title-actions
  a.btn.btn-primary.ms-3(href='/services/create') New

block head
  style.
    .flag-icon { font-size: 1.4rem; }
    .flag-disabled { filter: grayscale(100%); opacity: 0.5; }

block content
  .d-flex.align-items-center.gap-3.mb-3
    input#serviceFilter.form-control(type='text', placeholder='Filter services...', style='max-width: 300px', autofocus)
    .ms-auto
      if notConnectedInterfaces.length === 0
        span.text-info â„¹ï¸ all interfaces connected
      else
        span.text-danger âŒ interfaces not connected:
        each iface in notConnectedInterfaces
          strong.ms-1= iface.name

  if services.length === 0
    p.text-muted No services found.
  else
    .table-responsive
      table.table.table-striped.table-hover
        thead
          tr
            th
            th Name
            th Domains
            th Actions
        tbody
          each service in services
            tr
              td.status-cell
                each iface in service.interfaces
                  - const flagMap = { lithuania: 'ğŸ‡±ğŸ‡¹', netherlands: 'ğŸ‡³ğŸ‡±', new_york: 'ğŸ‡ºğŸ‡¸', usa: 'ğŸ‡ºğŸ‡¸', us: 'ğŸ‡ºğŸ‡¸', poland: 'ğŸ‡µğŸ‡±', germany: 'ğŸ‡©ğŸ‡ª', uk: 'ğŸ‡¬ğŸ‡§', united_kingdom: 'ğŸ‡¬ğŸ‡§', france: 'ğŸ‡«ğŸ‡·', canada: 'ğŸ‡¨ğŸ‡¦', japan: 'ğŸ‡¯ğŸ‡µ', australia: 'ğŸ‡¦ğŸ‡º', sweden: 'ğŸ‡¸ğŸ‡ª', switzerland: 'ğŸ‡¨ğŸ‡­', italy: 'ğŸ‡®ğŸ‡¹', spain: 'ğŸ‡ªğŸ‡¸', brazil: 'ğŸ‡§ğŸ‡·', india: 'ğŸ‡®ğŸ‡³', singapore: 'ğŸ‡¸ğŸ‡¬', south_korea: 'ğŸ‡°ğŸ‡·', turkey: 'ğŸ‡¹ğŸ‡·', mexico: 'ğŸ‡²ğŸ‡½', argentina: 'ğŸ‡¦ğŸ‡·', finland: 'ğŸ‡«ğŸ‡®', norway: 'ğŸ‡³ğŸ‡´', denmark: 'ğŸ‡©ğŸ‡°', ireland: 'ğŸ‡®ğŸ‡ª', czech_republic: 'ğŸ‡¨ğŸ‡¿', romania: 'ğŸ‡·ğŸ‡´', bulgaria: 'ğŸ‡§ğŸ‡¬', austria: 'ğŸ‡¦ğŸ‡¹', belgium: 'ğŸ‡§ğŸ‡ª', portugal: 'ğŸ‡µğŸ‡¹', serbia: 'ğŸ‡·ğŸ‡¸', ukraine: 'ğŸ‡ºğŸ‡¦', georgia: 'ğŸ‡¬ğŸ‡ª', israel: 'ğŸ‡®ğŸ‡±', hong_kong: 'ğŸ‡­ğŸ‡°', taiwan: 'ğŸ‡¹ğŸ‡¼', latvia: 'ğŸ‡±ğŸ‡»', estonia: 'ğŸ‡ªğŸ‡ª' }
                  - const flag = flagMap[iface.name.toLowerCase()] || 'ğŸ³ï¸'
                  span.flag-icon(class=service.enabled ? '' : 'flag-disabled', title=iface.name)= flag
              td
                a(href=`/services/${service.id}`)= service.name
              td= service.matchingDomains.join(', ')
              td
                a.btn.btn-sm.btn-secondary(href=`/services/update/${service.id}`) Edit

    script.
      document.getElementById('serviceFilter').addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const rows = document.querySelectorAll('table tbody tr');
        rows.forEach(function(row) {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(filter) ? '' : 'none';
        });
      });
